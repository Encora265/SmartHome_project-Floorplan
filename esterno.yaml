button_card_templates: !include_dir_merge_named button_card_templates
title: Esterno
views:

    #############################################################################################################################################
    #                                                                                                                                           #
    #                                                      Floorplan View Giardino                                                              #
    #                                                                                                                                           #
    #############################################################################################################################################

  - title: Esterno
    icon: 'mdi:flower'
    panel: true
    badges: []
    cards:

        ###################   config-template-card    #####################

      - type: 'custom:config-template-card'
        entities:
          - light.parentesi_group
          - light.luce_tavolo
          - switch.luce_ripostiglio
          - switch.banco
          - light.cucina_windcalm_2
          - media_player.55pus8009_12
          - light.55pus8009_12_luce_ambientale
          - light.luci_esterne
          - light.luci_auto
          - light.luci_esterne
          - light.luce_bagno
          - light.luci_fly
          - cover.garage
          - binary_sensor.garage_contact
          - input_boolean.luci_viale

        card:

          ###################   Picture Elements Card    #####################
          type: picture-elements
          image: /local/floorplan/transparent.png
          style: |
            ha-card:first-child {
              background: rgba(42, 46, 48, 1)
            }
          elements:

              #########################    DAY BASE FLOORPLAN OVERLAY    #########################

            - action: none
              entity: sun.sun
              hold_action:
                action: none
              state_image:
                above_horizon: /local/floorplan/terra/p0_day.png
                below_horizon: /local/floorplan/transparent.png
              style:
                height: auto
                left: 55%
                mix-blend-mode: lighten
                opacity: '${ states[''sensor.sunlight_opacity''].state }'
                top: 52.00%
                width: 120%
              tap_action:
                action: none
              type: image

              #########################    Inside overlays for weather    #########################

            - action: none
              hold_action:
                action: none
              image: /local/floorplan/terra/p0_night.png
              style:
                height: auto
                left: 55%
                top: 52.00%
                width: 120%
              tap_action:
                action: none
              type: image

            - action: none
              entity: sun.sun
              hold_action:
                action: none
              state_image:
                above_horizon: /local/floorplan/terra/p0_day.png
                below_horizon: /local/floorplan/transparent.png
              style:
                height: auto
                left: 55%
                mix-blend-mode: lighten
                opacity: '${ states[''sensor.sunlight_opacity''].state }'
                top: 52.00%
                width: 120%
              tap_action:
                action: none
              type: image

            #################################################
            #                                               #
            #          LUCI INDIVIDUALI - RENDERING         #
            #                                               #
            #################################################

            ######### PARENTESI ##########

            ######### PARENTESI - Layer 1: Base bianca ##########

            - action: none
              entity: light.parentesi_group
              hold_action:
                action: none
              image: /local/floorplan/transparent.png
              state_image:
                'on': /local/floorplan/terra/p0_parentesi.png
              tap_action:
                action: none
              type: image
              style:
                opacity: >-
                  ${ ( states["light.parentesi_group"].attributes.brightness ?
                  states["light.parentesi_group"].attributes.brightness / 255 : 0) -
                  (states["light.parentesi_group"].attributes.hs_color ?
                  states["light.parentesi_group"].attributes.hs_color[1]/90 : 0)}
                mix-blend-mode: lighten
                left: 55.00%
                top: 52.00%
                width: 120%
            
            ######### PARENTESI - Layer 2: CCT (bianca calda/fredda) ##########
   
            - action: none
              entity: light.parentesi_group
              hold_action:
                action: none
              image: /local/floorplan/transparent.png
              state_image:
                'on': /local/floorplan/terra/p0_parentesi.png  # immagine BIANCA
              tap_action:
                action: none
              type: image
              style:
                filter: >-
                  ${(() => {
                    const e = states["light.parentesi_group"].attributes;
                    const kelvin = e.color_temp_kelvin || 4000;
                    const ratio = Math.min(Math.max((kelvin - 2000) / (6500 - 2000), 0), 1);
                    const brightness = e.brightness ? e.brightness / 255 : 0.6;
                    
                    // Caldo (2000K) = giallo/arancio, Freddo (6500K) = blu
                    const sepiaLevel = 1 - ratio;  // 1 per caldo, 0 per freddo
                    const hueRotate = (sepiaLevel - 0.5) * 30;  // ±15°
                    
                    return `sepia(${sepiaLevel}) hue-rotate(${hueRotate}deg) brightness(${brightness + 0.1})`;  // ridotto da +0.4 a +0.2
                  })()}
                opacity: >-
                  ${(() => {
                    const e = states["light.parentesi_group"].attributes;
                    const sat = e.hs_color ? e.hs_color[1] : 0;
                    if (e.color_mode !== 'hs' || sat <= 10) {
                      const brightness = e.brightness ? e.brightness / 255 : 0.6;
                      return brightness * 0.7;
                    }
                    return 0;
                  })()}
                mix-blend-mode: lighten
                left: 55.00%
                top: 52.00%
                width: 120%
            
            ######### PARENTESI - Layer 3: RGB (colorata) ##########

            - action: none
              entity: light.parentesi_group
              hold_action:
                action: none
              image: /local/floorplan/transparent.png
              state_image:
                'on': /local/floorplan/terra/p0_parentesirgb.png  # immagine ROSSA/COLORATA
              tap_action:
                action: none
              type: image
              style:
                filter: >-
                  ${(() => {
                    const e = states["light.parentesi_group"].attributes;
                    const hue = e.hs_color ? e.hs_color[0] : 0;
                    const sat = e.hs_color ? e.hs_color[1] : 0;
                    const bright = e.brightness ? e.brightness / 255 : 0.7;
                    
                    return `hue-rotate(${hue}deg) saturate(${sat + 20}%) brightness(${0.6 + bright * 0.6})`;
                  })()}
                opacity: >-
                  ${(() => {
                    const e = states["light.parentesi_group"].attributes;
                    const sat = e.hs_color ? e.hs_color[1] : 0;
                    
                     if (e.color_mode === 'hs' && sat > 10) {
                      const bright = e.brightness ? e.brightness / 255 : 0.7;
                      return bright;
                    }
                    return 0;
                  })()}
                mix-blend-mode: lighten
                left: 55.00%
                top: 52.00%
                width: 120%

            ######### TAVOLO ##########

            - action: none
              entity: light.luce_tavolo
              hold_action:
                action: none
              image: /local/floorplan/terra/p0_tavolo.png
              style:
                left: 55.00%
                top: 52.00%
                width: 120%
                height: auto
                mix-blend-mode: lighten
                opacity: "${states['light.luce_tavolo'].state === 'on' ? '1' : '0'}"
              tap_action:
                action: none
              type: image

            ######### RIPOSTIGLIO ##########

            - action: none
              entity: switch.luce_ripostiglio
              hold_action:
                action: none
              image: /local/floorplan/terra/p0_ripostiglio.png
              style:
                left: 55.00%
                top: 52.00%
                width: 120%
                height: auto
                mix-blend-mode: lighten
                opacity: "${states['switch.luce_ripostiglio'].state === 'on' ? '1' : '0'}"
              tap_action:
                action: none
              type: image

            ######### SCALA 1 ##########

            - action: none
              entity: input_boolean.luce_scala1
              hold_action:
                action: none
              image: /local/floorplan/terra/p0_scala1.png
              style:
                left: 55.00%
                top: 52.00%
                width: 120%
                height: auto
                mix-blend-mode: lighten
                opacity: "${states['input_boolean.luce_scala1'].state === 'on' ? '1' : '0'}"
              tap_action:
                action: none
              type: image

            ######### BANCO ##########

            - action: none
              entity: switch.banco
              hold_action:
                action: none
              image: /local/floorplan/terra/p0_banco.png
              style:
                left: 55.00%
                top: 52.00%
                width: 120%
                height: auto
                mix-blend-mode: lighten
                opacity: "${states['switch.banco'].state === 'on' ? '1' : '0'}"
              tap_action:
                action: none
              type: image

            ######### CUCINA ##########

            - action: none
              entity: light.cucina_windcalm_2
              hold_action:
                action: none
              image: /local/floorplan/terra/p0_cucina.png
              style:
                filter: >-
                  ${(() => {
                    const e = states['light.cucina_windcalm_2'].attributes;
                    const kelvin = e.color_temp_kelvin || 4000;
                    const ratio = (kelvin - 2000) / (6500 - 2000);
                    const sepiaLevel = 1 - ratio;
                    const hueRotate = (sepiaLevel - 0.5) * 30;
                    const brightness = e.brightness ? e.brightness / 255 : 0.6;
                    return `sepia(${sepiaLevel}) hue-rotate(${hueRotate}deg) brightness(${brightness + 0.6})`;  // aumentato da +0.4 a +0.6
                  })()}
                opacity: >-
                  ${states['light.cucina_windcalm_2'].state === 'on'
                    ? ((states['light.cucina_windcalm_2'].attributes.brightness || 180) / 255) * 1.2  // aumentata del 20%
                    : 0}
                mix-blend-mode: lighten
                left: 55.00%
                top: 52.00%
                width: 120%
                height: auto
              tap_action:
                action: none
              type: image

            ######### SPECCHIO BAGNO ##########

            - action: none
              entity: light.luce_bagno
              hold_action:
                action: none
              image:  /local/floorplan/terra/p0_specchio.png
              style:
                filter: >-
                  ${(() => {
                    const e = states['light.luce_bagno'].attributes;
                    const kelvin = e.color_temp_kelvin || 4000;
                    const ratio = (kelvin - 2000) / (6500 - 2000);
                    const sepiaLevel = 1 - ratio;
                    const hueRotate = (sepiaLevel - 0.5) * 30;
                    const brightness = e.brightness ? e.brightness / 255 : 0.6;
                    return `sepia(${sepiaLevel}) hue-rotate(${hueRotate}deg) brightness(${brightness + 0.6})`;
                  })()}
                opacity: >-
                  ${states['light.luce_bagno'].state === 'on'
                    ? ((states['light.luce_bagno'].attributes.brightness || 180) / 255) * 1.2
                    : 0}
                mix-blend-mode: lighten
                left: 55.00%
                top: 52.00%
                width: 120%
                height: auto
              tap_action:
                action: none
              type: image

            ######### PHILIPS TV ##########

            - action: none
              entity: media_player.55pus8009_12
              hold_action:
                action: toggle
              state_image:
                "on": /local/floorplan/terra/p0_tv.png
                "off": /local/floorplan/transparent.png
              style:
                filter: >-
                  ${ "hue-rotate(" + (states['media_player.55pus8009_12'].attributes.hs_color
                  ? states['media_player.55pus8009_12'].attributes.hs_color[0] : 0) + "deg)"}
                left: 55.00%
                mix-blend-mode: lighten
                opacity: "${states['media_player.55pus8009_12'].state === 'on' ? (states['media_player.55pus8009_12'].attributes.brightness / 255) : '0'}"
                top: 52.00%
                width: 120%
                height: auto
              tap_action:
                action: none
              type: image

            ######### AMBILIGHT ##########

            - action: none
              entity: light.55pus8009_12_luce_ambientale
              hold_action:
                action: none
              image: /local/floorplan/terra/p0_ambilight.png
              style:
                filter: >-
                  ${ "hue-rotate(" + (states['light.55pus8009_12_luce_ambientale'].attributes.hs_color
                  ? states['light.55pus8009_12_luce_ambientale'].attributes.hs_color[0] : 0) + "deg)"}
                left: 55.00%
                mix-blend-mode: lighten
                opacity: "${states['light.55pus8009_12_luce_ambientale'].state === 'on' ? (states['light.55pus8009_12_luce_ambientale'].attributes.brightness / 255) : '0'}"
                top: 52.00%
                width: 120%
                height: auto
              tap_action:
                action: none
              type: image

            ######### TABLET ##########

            - action: none
              entity: binary_sensor.my_wall_panel_motion_detected
              hold_action:
                action: none
              state_image:
                "on": /local/floorplan/terra/p0_tablet.png
                "off": /local/floorplan/transparent.png
              style:
                filter: >-
                  ${ "hue-rotate(" + (states['binary_sensor.my_wall_panel_motion_detected'].attributes.hs_color
                  ? states['binary_sensor.my_wall_panel_motion_detected'].attributes.hs_color[0] : 0) + "deg)"}
                left: 55.00%
                mix-blend-mode: lighten
                opacity: "${states['binary_sensor.my_wall_panel_motion_detected'].state === 'on' ? (states['binary_sensor.my_wall_panel_motion_detected'].attributes.brightness / 255) : '0'}"
                top: 52.00%
                width: 120%
                height: auto
              tap_action:
                action: none
              type: image

            ######### LUCI ESTERNE ##########

            - action: none
              entity: light.luci_esterne
              hold_action:
                action: none
              image: /local/floorplan/terra/p0_esterne.png
              style:
                filter: >-
                  ${ "hue-rotate(" + (states['light.luci_esterne'].attributes.hs_color
                  ? states['light.luci_esterne'].attributes.hs_color[0] : 0) + "deg)"}
                left: 55.00%
                mix-blend-mode: lighten
                opacity: "${states['light.luci_esterne'].state === 'on' ? (states['light.luci_esterne'].attributes.brightness / 255) : '0'}"
                top: 52.00%
                width: 120%
                height: auto
              tap_action:
                action: none
              type: image

            ######### LUCI AUTO ##########

            - action: none
              entity: light.luci_auto
              hold_action:
                action: none
              image: /local/floorplan/terra/p0_auto.png
              style:
                filter: >-
                  ${ "hue-rotate(" + (states['light.luci_auto'].attributes.hs_color
                  ? states['light.luci_auto'].attributes.hs_color[0] : 0) + "deg)"}
                left: 55.00%
                mix-blend-mode: lighten
                opacity: "${states['light.luci_auto'].state === 'on' ? (states['light.luci_auto'].attributes.brightness / 255) : '0'}"
                top: 52.00%
                width: 120%
                height: auto
              tap_action:
                action: none
              type: image

            ######### LUCI FLY ##########

            - action: none
              entity: light.luci_fly
              hold_action:
                action: none
              image: /local/floorplan/terra/p0_fly.png
              style:
                filter: >-
                  ${ "hue-rotate(" + (states['light.luci_fly'].attributes.hs_color
                  ? states['light.luci_fly'].attributes.hs_color[0] : 0) + "deg)"}
                left: 55.00%
                mix-blend-mode: lighten
                opacity: "${states['light.luci_fly'].state === 'on' ? (states['light.luci_fly'].attributes.brightness / 255) : '0'}"
                top: 52.00%
                width: 120%
                height: auto
              tap_action:
                action: none
              type: image
              
            ######### LUCI VIALE ##########

            - action: none
              entity: input_boolean.luci_viale
              hold_action:
                action: none
              image: /local/floorplan/terra/p0_viale.png
              style:
                filter: >-
                  ${ "hue-rotate(" + (states['input_boolean.luci_viale'].attributes.hs_color
                  ? states['input_boolean.luci_viale'].attributes.hs_color[0] : 0) + "deg)"}
                left: 55.00%
                mix-blend-mode: lighten
                opacity: "${states['input_boolean.luci_viale'].state === 'on' ? (states['input_boolean.luci_viale'].attributes.brightness / 255) : '0'}"
                top: 52.00%
                width: 120%
                height: auto
              tap_action:
                action: none
              type: image

            ######### GARAGE ##########

            - action: none
              entity: binary_sensor.garage_contact
              hold_action:
                action: none
              image: /local/floorplan/terra/p0_garage.png
              style:
                left: 55.00%
                mix-blend-mode: lighten
                opacity: "${states['binary_sensor.garage_contact'].state === 'on' ? '1' : '0'}"
                top: 52.00%
                width: 120%
                height: auto
              tap_action:
                action: none
              type: image

            #################################################
            #                                               #
            #              PULSANTI TRASPARENTI             #
            #                                               #
            #################################################

            ######### PARENTESI ##########

            - type: image
              entity: light.parentesi_group
              image: /local/floorplan/transparent.png
              tap_action:
                action: call-service
                service: homeassistant.toggle
                service_data:
                  entity_id: light.parentesi_group
              hold_action:
                action: fire-dom-event
                browser_mod:
                  service: browser_mod.popup
                  data:
                    dismissable: true
                    size: normal
                    content:
                      type: custom:mod-card
                      card_mod:
                        style: |
                          ha-dialog {
                            position: absolute !important;
                            top: 150px !important;    /* regola qui verticalmente */
                            left: 300px !important;   /* regola qui orizzontalmente */
                            transform: none !important;
                          }
                      card:
                        type: custom:mushroom-light-card
                        entity: light.parentesi_group
                        fill_container: true
                        use_light_color: true
                        show_color_control: true
                        show_color_temp_control: true
                        show_brightness_control: true
                        layout: horizontal
              style:
                height: 4.50%
                left: 62.00%
                top: 59.00%
                width: 3.00%
                # border: 1px solid red
                template:
                  - light

            ######### TAVOLO ##########

            - type: image
              entity: light.luce_tavolo
              image: /local/floorplan/transparent.png
              tap_action:
                action: call-service
                service: homeassistant.toggle
                service_data:
                  entity_id: light.luce_tavolo
              hold_action:
                action: fire-dom-event
                browser_mod:
                  service: browser_mod.popup
                  popup_anchor: true
                  data:
                    dismissable: true
                    size: normal
                    content:
                      type: custom:mushroom-light-card
                      entity: light.luce_tavolo
                      icon: mdi:ceiling-light
                      use_light_color: false
                      show_brightness_control: false
              style:
                height: 6.00%
                left: 60.40%
                top: 16.00%
                width: 6.50%
                # border: 1px solid red
                template:
                  - light

            ######### RIPOSTIGLIO ##########

            - type: image
              entity: switch.luce_ripostiglio
              image: /local/floorplan/transparent.png
              tap_action:
                action: call-service
                service: homeassistant.toggle
                service_data:
                  entity_id: switch.luce_ripostiglio
              style:
                height: 4.00%
                left: 73.00%
                top: 31.50%
                width: 5.00%
                # border: 1px solid red
                template:
                  - light

            ######### BANCO ##########

            - type: image
              entity: switch.banco
              image: /local/floorplan/transparent.png
              tap_action:
                action: call-service
                service: homeassistant.toggle
                service_data:
                  entity_id: switch.banco
              hold_action:
                action: fire-dom-event
                browser_mod:
                  service: browser_mod.popup
                  popup_anchor: true
                  data:
                    dismissable: true
                    size: normal
                    content:
                      type: custom:mushroom-light-card
                      entity: switch.banco
                      icon: mdi:ceiling-light
                      use_light_color: false
                      show_brightness_control: false   
              style:
                height: 11.00%
                left: 71.80%
                top: 47.50%
                width: 3.80%
                # border: 1px solid red
                template:
                  - light

            ######### CUCINA ##########

            - type: image
              entity: light.cucina_windcalm_2
              image: /local/floorplan/transparent.png
              tap_action:
                action: call-service
                service: homeassistant.toggle
                service_data:
                  entity_id: light.cucina_windcalm_2
              hold_action:
                action: fire-dom-event
                browser_mod:
                  service: browser_mod.popup
                  popup_anchor: true
                  data:
                    dismissable: true
                    size: normal
                    content:
                      type: custom:mushroom-light-card
                      entity: light.cucina_windcalm
                      use_light_color: true
                      show_brightness_control: false
                      show_color_temp_control: true
                      show_color_control: false                     
              style:
                height: 21.00%
                left: 82.00%
                top: 43.00%
                width: 11.33%
                # border: 1px solid red
                template:
                  - light

            ######### SPECCHIO BAGNO ##########

            - type: image
              entity: light.luce_bagno
              image: /local/floorplan/transparent.png
              tap_action:
                action: call-service
                service: homeassistant.toggle
                service_data:
                  entity_id: light.luce_bagno
              hold_action:
                action: fire-dom-event
                browser_mod:
                  service: browser_mod.popup
                  data:
                    dismissable: true
                    size: normal
                    content:
                      type: custom:mod-card
                      card_mod:
                        style: |
                          ha-dialog {
                            position: absolute !important;
                            top: 150px !important;    /* regola qui verticalmente */
                            left: 300px !important;   /* regola qui orizzontalmente */
                            transform: none !important;
                          }
                      card:
                        type: custom:mushroom-light-card
                        entity: light.luce_bagno
                        fill_container: true
                        use_light_color: true
                        show_color_control: true
                        show_color_temp_control: true
                        show_brightness_control: true
                        layout: horizontal
              style:
                height: 3.00%
                left: 78.80%
                top: 31.00%
                width: 3.50%
                # border: 1px solid red
                template:
                  - light

            ######### LUCI ESTERNE ##########

            - type: image
              entity: light.luci_esterne
              image: /local/floorplan/transparent.png
              tap_action:
                action: call-service
                service: homeassistant.toggle
                service_data:
                  entity_id: light.luci_esterne
              hold_action:
                action: fire-dom-event
                browser_mod:
                  service: browser_mod.popup
                  popup_anchor: true
                  data:
                    dismissable: true
                    size: normal
                    content:
                      type: custom:mushroom-light-card
                      entity: light.luci_esterne
                      use_light_color: true
                      show_brightness_control: true
              double_tap_action: !include popup/luci_esterne.yaml
              style:
                height: 5.50%
                left: 64.40%
                top: 64.40%
                width: 41.80%
                # border: 1px solid red
                template:
                  - light

            ######### LUCI VIALE ##########

            - type: image
              entity: liginput_boolean.luci_viale
              image: /local/floorplan/transparent.png
              tap_action:
                action: call-service
                service: homeassistant.toggle
                service_data:
                  entity_id: input_boolean.luci_viale
              hold_action:
                action: fire-dom-event
                browser_mod:
                  service: browser_mod.popup
                  popup_anchor: true
                  data:
                    dismissable: true
                    size: normal
                    content:
                      type: custom:mushroom-light-card
                      entity: input_boolean.luci_viale
                      use_light_color: true
                      show_brightness_control: true
              style:
                height: 44.00%
                left: 30.40%
                top: 29.50%
                width: 14.00%
                # border: 1px solid red
                template:
                  - light

            ######### LUCI AUTO ##########

            - type: image
              entity: light.luci_auto
              image: /local/floorplan/transparent.png
              tap_action:
                action: call-service
                service: homeassistant.toggle
                service_data:
                  entity_id: light.luci_auto
              hold_action:
                action: fire-dom-event
                browser_mod:
                  service: browser_mod.popup
                  popup_anchor: true
                  data:
                    dismissable: true
                    size: normal
                    content:
                      type: custom:mushroom-light-card
                      entity: light.luci_auto
                      use_light_color: true
                      show_brightness_control: true                     
              style:
                height: 12%
                left: 32.50%
                top: 78%
                width: 13%
                # border: 1px solid red
                transform: |
                  translate(-50%, -100%)        /* centro */
                  rotate(90deg)               /* inclinazione “di taglio” */
                template:
                  - light

            ######### LUCI FLY ##########
              
            - type: image
              entity: light.luci_fly
              image: /local/floorplan/transparent.png
              tap_action:
                action: call-service
                service: homeassistant.toggle
                service_data:
                  entity_id: light.luci_fly
              hold_action:
                action: fire-dom-event
                browser_mod:
                  service: browser_mod.popup
                  popup_anchor: true
                  data:
                    dismissable: true
                    size: normal
                    content:
                      type: custom:mushroom-light-card
                      entity: light.luci_fly
                      use_light_color: true
                      show_brightness_control: true 
              style:
                height: 28%
                left: 78.30%
                top: 82%
                width: 13.50%
                # border: 1px solid red
                template:
                  - light

            ######### ROBOROCK ##########
              
            - type: image
              entity: vacuum.roborock_q8_max
              state_image:
                "idle": /local/floorplan/roborock/roborockstop.gif
                "docked": /local/floorplan/roborock/roborockstop.gif
                "paused": /local/floorplan/roborock/roborockstop.gif
                "cleaning": /local/floorplan/roborock/roborock_move.gif
                "returning": /local/floorplan/roborock/roborock_move.gif
              tap_action:
                action: fire-dom-event
                browser_mod:
                  service: browser_mod.popup
                  popup_anchor: true
                  data:
                    dismissable: true
                    size: normal
                    content:
                      type: custom:mushroom-vacuum-card
                      entity: vacuum.roborock_q8_max
                      icon_animation: true
                      layout: horizontal
                      commands:
                        - start_pause
                        - on_off
                        - return_home
                        - stop
                      fill_container: true
              hold_action:
                action: fire-dom-event
                browser_mod:
                  service: browser_mod.popup
                  popup_anchor: true
                  data:
                    dismissable: true
                    size: normal
                    content:
                      type: custom:xiaomi-vacuum-map-card
                      map_source:
                        camera: camera.roborock_q8_max_map
                      calibration_source:
                        camera: true
                      entity: vacuum.roborock_q8_max
                      vacuum_platform: default
                      map_locked: true
                      two_finger_pan: true
                      map_modes:
                        - template: vacuum_clean_zone
                        - template: vacuum_goto
                        - template: vacuum_clean_segment
                          predefined_selections:
                            - id: "16"
                              icon:
                                name: mdi:broom
                                x: 28175
                                "y": 31450
                              label:
                                text: Room 16
                                x: 28175
                                "y": 31450
                                offset_y: 35
                              outline:
                                - - 25100
                                  - 29950
                                - - 31250
                                  - 29950
                                - - 31250
                                  - 32950
                                - - 25100
                                  - 32950
                            - id: "17"
                              icon:
                                name: mdi:broom
                                x: 23300
                                "y": 32175
                              label:
                                text: Room 17
                                x: 23300
                                "y": 32175
                                offset_y: 35
                              outline:
                                - - 22200
                                  - 30850
                                - - 24400
                                  - 30850
                                - - 24400
                                  - 33500
                                - - 22200
                                  - 33500
                            - id: "18"
                              icon:
                                name: mdi:broom
                                x: 22200
                                "y": 27475
                              label:
                                text: Room 18
                                x: 22200
                                "y": 27475
                                offset_y: 35
                              outline:
                                - - 20900
                                  - 25450
                                - - 23500
                                  - 25450
                                - - 23500
                                  - 29500
                                - - 20900
                                  - 29500
                            - id: "19"
                              icon:
                                name: mdi:broom
                                x: 22950
                                "y": 30225
                              label:
                                text: Room 19
                                x: 22950
                                "y": 30225
                                offset_y: 35
                              outline:
                                - - 21950
                                  - 29550
                                - - 23950
                                  - 29550
                                - - 23950
                                  - 30900
                                - - 21950
                                  - 30900
                            - id: "20"
                              icon:
                                name: mdi:broom
                                x: 27850
                                "y": 27175
                              label:
                                text: Room 20
                                x: 27850
                                "y": 27175
                                offset_y: 35
                              outline:
                                - - 23450
                                  - 24450
                                - - 32250
                                  - 24450
                                - - 32250
                                  - 29900
                                - - 23450
                                  - 29900
                        - template: vacuum_clean_segment
                          predefined_selections:
                            - id: "16"
                              icon:
                                name: mdi:broom
                                x: 28175
                                "y": 31450
                              label:
                                text: Room 16
                                x: 28175
                                "y": 31450
                                offset_y: 35
                              outline:
                                - - 25100
                                  - 29950
                                - - 31250
                                  - 29950
                                - - 31250
                                  - 32950
                                - - 25100
                                  - 32950
                            - id: "17"
                              icon:
                                name: mdi:broom
                                x: 23300
                                "y": 32175
                              label:
                                text: Room 17
                                x: 23300
                                "y": 32175
                                offset_y: 35
                              outline:
                                - - 22200
                                  - 30850
                                - - 24400
                                  - 30850
                                - - 24400
                                  - 33500
                                - - 22200
                                  - 33500
                            - id: "18"
                              icon:
                                name: mdi:broom
                                x: 22200
                                "y": 27475
                              label:
                                text: Room 18
                                x: 22200
                                "y": 27475
                                offset_y: 35
                              outline:
                                - - 20900
                                  - 25450
                                - - 23500
                                  - 25450
                                - - 23500
                                  - 29500
                                - - 20900
                                  - 29500
                            - id: "19"
                              icon:
                                name: mdi:broom
                                x: 22950
                                "y": 30225
                              label:
                                text: Room 19
                                x: 22950
                                "y": 30225
                                offset_y: 35
                              outline:
                                - - 21950
                                  - 29550
                                - - 23950
                                  - 29550
                                - - 23950
                                  - 30900
                                - - 21950
                                  - 30900
                            - id: "20"
                              icon:
                                name: mdi:broom
                                x: 27850
                                "y": 27175
                              label:
                                text: Room 20
                                x: 27850
                                "y": 27175
                                offset_y: 35
                              outline:
                                - - 23450
                                  - 24450
                                - - 32250
                                  - 24450
                                - - 32250
                                  - 29900
                                - - 23450
                                  - 29900
                        - template: vacuum_clean_segment
                          predefined_selections:
                            - id: "16"
                              icon:
                                name: mdi:broom
                                x: 28175
                                "y": 31450
                              label:
                                text: Room 16
                                x: 28175
                                "y": 31450
                                offset_y: 35
                              outline:
                                - - 25100
                                  - 29950
                                - - 31250
                                  - 29950
                                - - 31250
                                  - 32950
                                - - 25100
                                  - 32950
                            - id: "17"
                              icon:
                                name: mdi:broom
                                x: 23300
                                "y": 32175
                              label:
                                text: Room 17
                                x: 23300
                                "y": 32175
                                offset_y: 35
                              outline:
                                - - 22200
                                  - 30850
                                - - 24400
                                  - 30850
                                - - 24400
                                  - 33500
                                - - 22200
                                  - 33500
                            - id: "18"
                              icon:
                                name: mdi:broom
                                x: 22200
                                "y": 27475
                              label:
                                text: Room 18
                                x: 22200
                                "y": 27475
                                offset_y: 35
                              outline:
                                - - 20900
                                  - 25450
                                - - 23500
                                  - 25450
                                - - 23500
                                  - 29500
                                - - 20900
                                  - 29500
                            - id: "19"
                              icon:
                                name: mdi:broom
                                x: 22950
                                "y": 30225
                              label:
                                text: Room 19
                                x: 22950
                                "y": 30225
                                offset_y: 35
                              outline:
                                - - 21950
                                  - 29550
                                - - 23950
                                  - 29550
                                - - 23950
                                  - 30900
                                - - 21950
                                  - 30900
                            - id: "20"
                              icon:
                                name: mdi:broom
                                x: 27850
                                "y": 27175
                              label:
                                text: Room 20
                                x: 27850
                                "y": 27175
                                offset_y: 35
                              outline:
                                - - 23450
                                  - 24450
                                - - 32250
                                  - 24450
                                - - 32250
                                  - 29900
                                - - 23450
                                  - 29900
                        - template: vacuum_clean_segment
                          predefined_selections:
                            - id: "16"
                              icon:
                                name: mdi:broom
                                x: 28175
                                "y": 31450
                              label:
                                text: Room 16
                                x: 28175
                                "y": 31450
                                offset_y: 35
                              outline:
                                - - 25100
                                  - 29950
                                - - 31250
                                  - 29950
                                - - 31250
                                  - 32950
                                - - 25100
                                  - 32950
                            - id: "17"
                              icon:
                                name: mdi:broom
                                x: 23300
                                "y": 32175
                              label:
                                text: Room 17
                                x: 23300
                                "y": 32175
                                offset_y: 35
                              outline:
                                - - 22200
                                  - 30850
                                - - 24400
                                  - 30850
                                - - 24400
                                  - 33500
                                - - 22200
                                  - 33500
                            - id: "18"
                              icon:
                                name: mdi:broom
                                x: 22200
                                "y": 27475
                              label:
                                text: Room 18
                                x: 22200
                                "y": 27475
                                offset_y: 35
                              outline:
                                - - 20900
                                  - 25450
                                - - 23500
                                  - 25450
                                - - 23500
                                  - 29500
                                - - 20900
                                  - 29500
                            - id: "19"
                              icon:
                                name: mdi:broom
                                x: 22950
                                "y": 30225
                              label:
                                text: Room 19
                                x: 22950
                                "y": 30225
                                offset_y: 35
                              outline:
                                - - 21950
                                  - 29550
                                - - 23950
                                  - 29550
                                - - 23950
                                  - 30900
                                - - 21950
                                  - 30900
                            - id: "20"
                              icon:
                                name: mdi:broom
                                x: 27850
                                "y": 27175
                              label:
                                text: Room 20
                                x: 27850
                                "y": 27175
                                offset_y: 35
                              outline:
                                - - 23450
                                  - 24450
                                - - 32250
                                  - 24450
                                - - 32250
                                  - 29900
                                - - 23450
                                  - 29900
                        - template: vacuum_clean_segment
                          predefined_selections:
                            - id: "16"
                              icon:
                                name: mdi:broom
                                x: 28175
                                "y": 31450
                              label:
                                text: Room 16
                                x: 28175
                                "y": 31450
                                offset_y: 35
                              outline:
                                - - 25100
                                  - 29950
                                - - 31250
                                  - 29950
                                - - 31250
                                  - 32950
                                - - 25100
                                  - 32950
                            - id: "17"
                              icon:
                                name: mdi:broom
                                x: 23300
                                "y": 32175
                              label:
                                text: Room 17
                                x: 23300
                                "y": 32175
                                offset_y: 35
                              outline:
                                - - 22200
                                  - 30850
                                - - 24400
                                  - 30850
                                - - 24400
                                  - 33500
                                - - 22200
                                  - 33500
                            - id: "18"
                              icon:
                                name: mdi:broom
                                x: 22200
                                "y": 27475
                              label:
                                text: Room 18
                                x: 22200
                                "y": 27475
                                offset_y: 35
                              outline:
                                - - 20900
                                  - 25450
                                - - 23500
                                  - 25450
                                - - 23500
                                  - 29500
                                - - 20900
                                  - 29500
                            - id: "19"
                              icon:
                                name: mdi:broom
                                x: 22950
                                "y": 30225
                              label:
                                text: Room 19
                                x: 22950
                                "y": 30225
                                offset_y: 35
                              outline:
                                - - 21950
                                  - 29550
                                - - 23950
                                  - 29550
                                - - 23950
                                  - 30900
                                - - 21950
                                  - 30900
                            - id: "20"
                              icon:
                                name: mdi:broom
                                x: 27850
                                "y": 27175
                              label:
                                text: Room 20
                                x: 27850
                                "y": 27175
                                offset_y: 35
                              outline:
                                - - 23450
                                  - 24450
                                - - 32250
                                  - 24450
                                - - 32250
                                  - 29900
                                - - 23450
                                  - 29900
                        - template: vacuum_clean_segment
                          predefined_selections:
                            - id: "16"
                              icon:
                                name: mdi:broom
                                x: 28175
                                "y": 31450
                              label:
                                text: Room 16
                                x: 28175
                                "y": 31450
                                offset_y: 35
                              outline:
                                - - 25100
                                  - 29950
                                - - 31250
                                  - 29950
                                - - 31250
                                  - 32950
                                - - 25100
                                  - 32950
                            - id: "17"
                              icon:
                                name: mdi:broom
                                x: 23300
                                "y": 32175
                              label:
                                text: Room 17
                                x: 23300
                                "y": 32175
                                offset_y: 35
                              outline:
                                - - 22200
                                  - 30850
                                - - 24400
                                  - 30850
                                - - 24400
                                  - 33500
                                - - 22200
                                  - 33500
                            - id: "18"
                              icon:
                                name: mdi:broom
                                x: 22200
                                "y": 27475
                              label:
                                text: Room 18
                                x: 22200
                                "y": 27475
                                offset_y: 35
                              outline:
                                - - 20900
                                  - 25450
                                - - 23500
                                  - 25450
                                - - 23500
                                  - 29500
                                - - 20900
                                  - 29500
                            - id: "19"
                              icon:
                                name: mdi:broom
                                x: 22950
                                "y": 30225
                              label:
                                text: Room 19
                                x: 22950
                                "y": 30225
                                offset_y: 35
                              outline:
                                - - 21950
                                  - 29550
                                - - 23950
                                  - 29550
                                - - 23950
                                  - 30900
                                - - 21950
                                  - 30900
                            - id: "20"
                              icon:
                                name: mdi:broom
                                x: 27850
                                "y": 27175
                              label:
                                text: Room 20
                                x: 27850
                                "y": 27175
                                offset_y: 35
                              outline:
                                - - 23450
                                  - 24450
                                - - 32250
                                  - 24450
                                - - 32250
                                  - 29900
                                - - 23450
                                  - 29900
                        - template: vacuum_clean_segment
                          predefined_selections:
                            - id: "16"
                              icon:
                                name: mdi:broom
                                x: 28175
                                "y": 31450
                              label:
                                text: Room 16
                                x: 28175
                                "y": 31450
                                offset_y: 35
                              outline:
                                - - 25100
                                  - 29950
                                - - 31250
                                  - 29950
                                - - 31250
                                  - 32950
                                - - 25100
                                  - 32950
                            - id: "17"
                              icon:
                                name: mdi:broom
                                x: 23300
                                "y": 32175
                              label:
                                text: Room 17
                                x: 23300
                                "y": 32175
                                offset_y: 35
                              outline:
                                - - 22200
                                  - 30850
                                - - 24400
                                  - 30850
                                - - 24400
                                  - 33500
                                - - 22200
                                  - 33500
                            - id: "18"
                              icon:
                                name: mdi:broom
                                x: 22200
                                "y": 27475
                              label:
                                text: Room 18
                                x: 22200
                                "y": 27475
                                offset_y: 35
                              outline:
                                - - 20900
                                  - 25450
                                - - 23500
                                  - 25450
                                - - 23500
                                  - 29500
                                - - 20900
                                  - 29500
                            - id: "19"
                              icon:
                                name: mdi:broom
                                x: 22950
                                "y": 30225
                              label:
                                text: Room 19
                                x: 22950
                                "y": 30225
                                offset_y: 35
                              outline:
                                - - 21950
                                  - 29550
                                - - 23950
                                  - 29550
                                - - 23950
                                  - 30900
                                - - 21950
                                  - 30900
                            - id: "20"
                              icon:
                                name: mdi:broom
                                x: 27850
                                "y": 27175
                              label:
                                text: Room 20
                                x: 27850
                                "y": 27175
                                offset_y: 35
                              outline:
                                - - 23450
                                  - 24450
                                - - 32250
                                  - 24450
                                - - 32250
                                  - 29900
                                - - 23450
                                  - 29900
                        - template: vacuum_clean_segment
                          predefined_selections:
                            - id: "16"
                              icon:
                                name: mdi:broom
                                x: 28175
                                "y": 31450
                              label:
                                text: Room 16
                                x: 28175
                                "y": 31450
                                offset_y: 35
                              outline:
                                - - 25100
                                  - 29950
                                - - 31250
                                  - 29950
                                - - 31250
                                  - 32950
                                - - 25100
                                  - 32950
                            - id: "17"
                              icon:
                                name: mdi:broom
                                x: 23300
                                "y": 32175
                              label:
                                text: Room 17
                                x: 23300
                                "y": 32175
                                offset_y: 35
                              outline:
                                - - 22200
                                  - 30850
                                - - 24400
                                  - 30850
                                - - 24400
                                  - 33500
                                - - 22200
                                  - 33500
                            - id: "18"
                              icon:
                                name: mdi:broom
                                x: 22200
                                "y": 27475
                              label:
                                text: Room 18
                                x: 22200
                                "y": 27475
                                offset_y: 35
                              outline:
                                - - 20900
                                  - 25450
                                - - 23500
                                  - 25450
                                - - 23500
                                  - 29500
                                - - 20900
                                  - 29500
                            - id: "19"
                              icon:
                                name: mdi:broom
                                x: 22950
                                "y": 30225
                              label:
                                text: Room 19
                                x: 22950
                                "y": 30225
                                offset_y: 35
                              outline:
                                - - 21950
                                  - 29550
                                - - 23950
                                  - 29550
                                - - 23950
                                  - 30900
                                - - 21950
                                  - 30900
                            - id: "20"
                              icon:
                                name: mdi:broom
                                x: 27850
                                "y": 27175
                              label:
                                text: Room 20
                                x: 27850
                                "y": 27175
                                offset_y: 35
                              outline:
                                - - 23450
                                  - 24450
                                - - 32250
                                  - 24450
                                - - 32250
                                  - 29900
                                - - 23450
                                  - 29900
                        - template: vacuum_clean_segment
                          predefined_selections:
                            - id: "16"
                              icon:
                                name: mdi:broom
                                x: 28175
                                "y": 31450
                              label:
                                text: Room 16
                                x: 28175
                                "y": 31450
                                offset_y: 35
                              outline:
                                - - 25100
                                  - 29950
                                - - 31250
                                  - 29950
                                - - 31250
                                  - 32950
                                - - 25100
                                  - 32950
                            - id: "17"
                              icon:
                                name: mdi:broom
                                x: 23300
                                "y": 32175
                              label:
                                text: Room 17
                                x: 23300
                                "y": 32175
                                offset_y: 35
                              outline:
                                - - 22200
                                  - 30850
                                - - 24400
                                  - 30850
                                - - 24400
                                  - 33500
                                - - 22200
                                  - 33500
                            - id: "18"
                              icon:
                                name: mdi:broom
                                x: 22200
                                "y": 27475
                              label:
                                text: Room 18
                                x: 22200
                                "y": 27475
                                offset_y: 35
                              outline:
                                - - 20900
                                  - 25450
                                - - 23500
                                  - 25450
                                - - 23500
                                  - 29500
                                - - 20900
                                  - 29500
                            - id: "19"
                              icon:
                                name: mdi:broom
                                x: 22950
                                "y": 30225
                              label:
                                text: Room 19
                                x: 22950
                                "y": 30225
                                offset_y: 35
                              outline:
                                - - 21950
                                  - 29550
                                - - 23950
                                  - 29550
                                - - 23950
                                  - 30900
                                - - 21950
                                  - 30900
                            - id: "20"
                              icon:
                                name: mdi:broom
                                x: 27850
                                "y": 27175
                              label:
                                text: Room 20
                                x: 27850
                                "y": 27175
                                offset_y: 35
                              outline:
                                - - 23450
                                  - 24450
                                - - 32250
                                  - 24450
                                - - 32250
                                  - 29900
                                - - 23450
                                  - 29900

              style:
                height: auto
                left: 51.50%
                top: 58.00%
                width: 3.00%
                # mix-blend-mode: lighten
                # border: 1px solid red
                template:
                  - vacuum

            ######### RACCOLTA DIFFERENZIATA ##########

            - type: image
              image: /local/floorplan/transparent.png
              entity: calendar.raccolta_differenziata
              style:
                left: 31.30%
                top: 93.50%  
                width: 15.50%
                height: 4.50%
                # border: 1px solid red
              tap_action:
                action: fire-dom-event
                browser_mod:
                  service: browser_mod.popup
                  popup_anchor: true
                  data:
                    dismissable: true
                    content:
                      type: custom:mushroom-template-card
                      primary: >
                        {% if is_state("calendar.raccolta_differenziata", "on") %}
                          {{ state_attr("calendar.raccolta_differenziata", "message") }}
                        {% else %}
                          Nessun conferimento
                        {% endif %}
                      secondary: >
                        {% if states("sensor.giorni_raccolta") != "unknown" %}
                          Tra {{ states("sensor.giorni_raccolta") }} giorni
                        {% endif %}
                      icon: >
                        {% set rifiuto = state_attr("calendar.raccolta_differenziata", "message") | lower %}
                        {% if "umido" in rifiuto %}
                          mdi:food-apple-outline
                        {% elif "carta" in rifiuto %}
                          mdi:archive
                        {% elif "plastica" in rifiuto %}
                          mdi:bottle-soda
                        {% elif "vetro" in rifiuto %}
                          mdi:bottle-wine
                        {% else %}
                          mdi:trash-can
                        {% endif %}
                      icon_color: >
                        {% set rifiuto = state_attr("calendar.raccolta_differenziata", "message") | lower %}
                        {% if "umido" in rifiuto %}
                          brown
                        {% elif "carta" in rifiuto %}
                          yellow
                        {% elif "plastica" in rifiuto %}
                          amber
                        {% elif "vetro" in rifiuto %}
                          green
                        {% else %}
                          grey
                        {% endif %}
                      tap_action:
                        action: none
                      hold_action:
                        action: none
                      double_tap_action:
                        action: none

            ######### TABLET ##########

            - type: image
              image: /local/floorplan/transparent.png
              entity: binary_sensor.my_wall_panel_motion_detected
              style:
                left: 66.30%
                top: 27.30%  
                width: 2.00%
                height: auto
                # border: 1px solid red
              tap_action: !include popup/footer_tablet.yaml

            ######### GARAGE ##########

            - type: image
              entity: cover.garage
              image: /local/floorplan/transparent.png
              tap_action:
                action: call-service
                service: cover.toggle
                service_data:
                  entity_id: cover.garage
              hold_action:
                action: fire-dom-event
                browser_mod:
                  service: browser_mod.popup
                  popup_anchor: true
                  data:
                    dismissable: true
                    size: normal
                    content:
                      type: custom:mushroom-cover-card
                      entity: cover.garage
                      icon: mdi:garage
                      fill_container: true
                      show_position_control: false
                      show_buttons_control: true
              style:
                left: 47.20%
                top: 15.50%
                width: 7.00%
                height: 21.50%
                # border: 1px solid red

            ######### IRRIGAZIONE GETTI ##########

            - type: image
              entity: switch.irrigazione_group
              image: /local/floorplan/transparent.png
              tap_action:
                action: call-service
                service: switch.toggle
                service_data:
                  entity_id: switch.getti_group
              hold_action:
                action: fire-dom-event
                browser_mod:
                honeycomb_menu:
                  entity:
                    - switch.sonoff_1000162117_1
                    - switch.sonoff_1000162117_2
                    - switch.sonoff_1000162117_3
                    - switch.sonoff_1000162117_4
                  buttons:
                    - icon: 'mdi:sprinkler'
                      entity: switch.sonoff_1000162117_1
                      tap_action:
                        action: toggle
                    - icon: 'mdi:sprinkler'
                      entity: switch.sonoff_1000162117_2
                      tap_action:
                        action: toggle
                    - icon: 'mdi:sprinkler-variant'
                      entity: switch.getti_group
                      tap_action:
                        action: toggle
                    - icon: 'mdi:water'
                      entity: switch.sonoff_1000162117_3                      
                      tap_action:
                        action: toggle
                    - icon: 'mdi:flower'
                      entity: switch.sonoff_1000162117_4
                      tap_action:
                        action: toggle
                    - icon: 'mdi:watering-can-outline'
                      entity: switch.irrigazione_group
                      tap_action:
                        action: toggle
              style:
                left: 52.80%
                top: 79.50%
                width: 26.00%
                height: 24.00%
                # border: 1px solid red

            ######### IRRIGAZIONE GOCCIA ##########

            - type: image
              entity: switch.sonoff_1000162117_3
              image: /local/floorplan/transparent.png
              tap_action:
                action: call-service
                service: switch.toggle
                service_data:
                  entity_id: switch.sonoff_1000162117_3
              hold_action:
                action: fire-dom-event
                browser_mod:
                honeycomb_menu:
                  entity:
                    - switch.sonoff_1000162117_1
                    - switch.sonoff_1000162117_2
                    - switch.sonoff_1000162117_3
                    - switch.sonoff_1000162117_4
                  buttons:
                    - icon: 'mdi:sprinkler'
                      entity: switch.sonoff_1000162117_1
                      tap_action:
                        action: toggle
                    - icon: 'mdi:sprinkler'
                      entity: switch.sonoff_1000162117_2
                      tap_action:
                        action: toggle
                    - icon: 'mdi:sprinkler-variant'
                      entity: switch.getti_group
                      tap_action:
                        action: toggle
                    - icon: 'mdi:water'
                      entity: switch.sonoff_1000162117_3                      
                      tap_action:
                        action: toggle
                    - icon: 'mdi:flower'
                      entity: switch.sonoff_1000162117_4
                      tap_action:
                        action: toggle
                    - icon: 'mdi:watering-can-outline'
                      entity: switch.irrigazione_group
                      tap_action:
                        action: toggle
              style:
                left: 40.80%
                top: 60.50%
                width: 4.00%
                height: 19.00%
                # border: 1px solid red 
 
            ######### CAMERA INGRESSO ##########

            - type: image
              image: /local/floorplan/transparent.png
              entity: camera.ingresso
              style:
                left: 42.00%
                top: 39.30%  
                width: 9.00%
                height: 19.50%
                # border: 1px solid red
              tap_action:
                action: fire-dom-event
                browser_mod:
                  service: browser_mod.popup
                  popup_anchor: true
                  data:
                    title: Ingresso
                    dismissable: true
                    size: normal
                    content:
                      type: custom:frigate-card
                      cameras:
                        - camera_entity: camera.ingresso
                        
            ######### CAMBIO DASHBOARD ##########

            - type: image
              image: /local/floorplan/transparent.png
              style:
                left: 81.20%
                top: 16.30%  
                width: 11.00%
                height: 9.50%
                # border: 1px solid red
              tap_action:
                action: navigate
                navigation_path: /lovelace-primo/0
                        
            #################################################
            #                                               #
            #                     ICONE                     #
            #                                               #
            #################################################

            ######### CAMERA GIARDINO ##########

            - type: state-icon
              entity: camera.giardino
              icon: mdi:cctv
              tap_action:
                action: fire-dom-event
                browser_mod:
                  service: browser_mod.popup
                  data:
                    title: Giardino
                    dismissable: true
                    size: normal
                    content:
                      type: custom:frigate-card
                      cameras:
                        - camera_entity: camera.giardino
                      live:
                        controls:
                          ptz:
                            mode: "on"
                            orientation: horizontal
                            hide_home: false
              hold_action:
                action: fire-dom-event
                browser_mod:
                  service: browser_mod.popup
                  data:
                    dismissable: true
                    size: normal
                    content:
                      type: custom:mushroom-alarm-control-panel-card
                      entity: alarm_control_panel.ezviz_alarm
                      states:
                        - armed_home
                        - armed_away
                      fill_container: true
              style:
                color: '#cf07f2'
                left: 27.20%
                top: 70%
                width: 2vw
                height: 2vw
                transform: |
                  translate(-50%, -50%) scaleX(-1)        
                  rotate(20deg)               
                background-color: '#ffffff00'
                box-shadow: '0px 0px 28px 0px rgba(0,0,0,0.1)'
                border-radius: 50%
                z-index: 5

              #################################################################
              #                                                               #
              #                             SIDEBAR                           #
              #                                                               #
              #################################################################

            ######### DISPOSITIVI ##########

            - type: custom:button-card
              name: Dispositivi
              icon: mdi:lightbulb-group-outline
              tap_action:
                action: navigate
                navigation_path: /lovelace/0?kiosk
              style:
                top: 8.00%
                left: 12.00%
                width: 240px
                height: 45px
              layout: name_icon
              styles:
                card:
                  - display: flex
                  - flex-direction: row
                  - justify-content: flex-start
                  - align-items: center
                  - background: rgba(255, 255, 255, 0.1)
                  - backdrop-filter: blur(10px)
                  - border: 1px solid rgba(255, 255, 255, 0.2) 
                  - border-radius: 10px
                  - padding: 0 24px
                  - height: 100%
                  - position: relative
                  - overflow: hidden
                name:
                  - color: white
                  - font-size: 18px
                  - font-weight: bold
                  - margin-right: 110px
                  - transform: translateY(-5px)
                icon:
                  - color: white
                  - width: 28px
                  - height: 280px
                  - margin-left: 160px
                  - transform: translateY(-7px)
              card_mod:
                style: |
                  ha-card {
                    position: relative;
                    z-index: 0;
                  }
                  ha-card::before {
                    content: "";
                    position: absolute;
                    top: -4px;
                    left: -4px;
                    width: calc(100% + 8px);
                    height: calc(100% + 8px);
                    background: linear-gradient(
                      45deg,
                      #ff0000,
                      #ff7300,
                      #fffb00,
                      #48ff00,
                      #00ffd5,
                      #002bff,
                      #7a00ff,
                      #ff00c8,
                      #ff0000
                    );
                    background-size: 400%;
                    z-index: -1;
                    filter: blur(6px);   /* meno sfocato → bordo più netto */
                    border-radius: 12px;
                    animation: glowing 12s linear infinite; /* più veloce */
                    opacity: 1;
                  }
                  ha-card::after {
                    content: "";
                    position: absolute;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: #111;
                    z-index: -1;
                    border-radius: 10px;
                  }
                  @keyframes glowing {
                    0% { background-position: 0 0; }
                    50% { background-position: 400% 0; }
                    100% { background-position: 0 0; }
                  }  

            ######### MAIN ##########

            - type: custom:button-card
              name: Casa
              icon: mdi:home
              tap_action:
                action: navigate
                navigation_path: /lovelace-main/0?kiosk
              style:
                top: 16.00%
                left: 12.00%
                width: 240px
                height: 45px
              layout: name_icon
              styles:
                card:
                  - display: flex
                  - flex-direction: row
                  - justify-content: flex-start
                  - align-items: center
                  - background: rgba(255, 255, 255, 0.1)
                  - backdrop-filter: blur(10px)
                  - border: 1px solid rgba(255, 255, 255, 0.2) 
                  - border-radius: 10px
                  - padding: 0 24px
                  - height: 100%
                  - position: relative
                  - overflow: hidden
                name:
                  - color: white
                  - font-size: 18px
                  - font-weight: bold
                  - margin-right: 155px
                  - transform: translateY(-5px)
                icon:
                  - color: white
                  - width: 26px
                  - height: 26px
                  - margin-left: 160px
                  - transform: translateY(-5px)
              card_mod:
                style: |
                  ha-card {
                    position: relative;
                    z-index: 0;
                  }
                  ha-card::before {
                    content: "";
                    position: absolute;
                    top: -4px;
                    left: -4px;
                    width: calc(100% + 8px);
                    height: calc(100% + 8px);
                    background: linear-gradient(
                      45deg,
                      #ff0000,
                      #ff7300,
                      #fffb00,
                      #48ff00,
                      #00ffd5,
                      #002bff,
                      #7a00ff,
                      #ff00c8,
                      #ff0000
                    );
                    background-size: 400%;
                    z-index: -1;
                    filter: blur(6px);   /* meno sfocato → bordo più netto */
                    border-radius: 12px;
                    animation: glowing 12s linear infinite; /* più veloce */
                    opacity: 1;
                  }
                  ha-card::after {
                    content: "";
                    position: absolute;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: #111;
                    z-index: -1;
                    border-radius: 10px;
                  }
                  @keyframes glowing {
                    0% { background-position: 0 0; }
                    50% { background-position: 400% 0; }
                    100% { background-position: 0 0; }
                  }

            ######### PIANO TERRA ##########

            - type: custom:button-card
              name: Piano terra
              icon: mdi:home-floor-0
              tap_action:
                action: navigate
                navigation_path: /lovelace-terra/0?kiosk
              style:
                top: 24.00%
                left: 12.00%
                width: 240px
                height: 45px
              layout: name_icon
              styles:
                card:
                  - display: flex
                  - flex-direction: row
                  - justify-content: flex-start
                  - align-items: center
                  - background: rgba(255, 255, 255, 0.1)
                  - backdrop-filter: blur(10px)
                  - border: 1px solid rgba(255, 255, 255, 0.2) 
                  - border-radius: 10px
                  - padding: 0 24px
                  - height: 100%
                  - position: relative
                  - overflow: hidden
                name:
                  - color: white
                  - font-size: 18px
                  - font-weight: bold
                  - margin-right: 110px
                  - transform: translateY(-5px)
                icon:
                  - color: white
                  - width: 26px
                  - height: 26px
                  - margin-left: 160px
                  - transform: translateY(-5px)
              card_mod:
                style: |
                  ha-card {
                    position: relative;
                    z-index: 0;
                  }
                  ha-card::before {
                    content: "";
                    position: absolute;
                    top: -4px;
                    left: -4px;
                    width: calc(100% + 8px);
                    height: calc(100% + 8px);
                    background: linear-gradient(
                      45deg,
                      #ff0000,
                      #ff7300,
                      #fffb00,
                      #48ff00,
                      #00ffd5,
                      #002bff,
                      #7a00ff,
                      #ff00c8,
                      #ff0000
                    );
                    background-size: 400%;
                    z-index: -1;
                    filter: blur(6px);   /* meno sfocato → bordo più netto */
                    border-radius: 12px;
                    animation: glowing 12s linear infinite; /* più veloce */
                    opacity: 1;
                  }
                  ha-card::after {
                    content: "";
                    position: absolute;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: #111;
                    z-index: -1;
                    border-radius: 10px;
                  }
                  @keyframes glowing {
                    0% { background-position: 0 0; }
                    50% { background-position: 400% 0; }
                    100% { background-position: 0 0; }
                  }

            ######### PRIMO PIANO ##########

            - type: custom:button-card
              name: Primo piano
              icon: mdi:home-floor-1
              tap_action:
                action: navigate
                navigation_path: /lovelace-primo/0?kiosk
              style:
                top: 32.00%
                left: 12.00%
                width: 240px
                height: 45px
              layout: name_icon
              styles:
                card:
                  - display: flex
                  - flex-direction: row
                  - justify-content: flex-start
                  - align-items: center
                  - background: rgba(255, 255, 255, 0.1)
                  - backdrop-filter: blur(10px)
                  - border: 1px solid rgba(255, 255, 255, 0.2) 
                  - border-radius: 10px
                  - padding: 0 24px
                  - height: 100%
                  - position: relative
                  - overflow: hidden
                name:
                  - color: white
                  - font-size: 18px
                  - font-weight: bold
                  - margin-right: 100px
                  - transform: translateY(-5px)
                icon:
                  - color: white
                  - width: 26px
                  - height: 26px
                  - margin-left: 160px
                  - transform: translateY(-5px)
              card_mod:
                style: |
                  ha-card {
                    position: relative;
                    z-index: 0;
                  }
                  ha-card::before {
                    content: "";
                    position: absolute;
                    top: -4px;
                    left: -4px;
                    width: calc(100% + 8px);
                    height: calc(100% + 8px);
                    background: linear-gradient(
                      45deg,
                      #ff0000,
                      #ff7300,
                      #fffb00,
                      #48ff00,
                      #00ffd5,
                      #002bff,
                      #7a00ff,
                      #ff00c8,
                      #ff0000
                    );
                    background-size: 400%;
                    z-index: -1;
                    filter: blur(6px);   /* meno sfocato → bordo più netto */
                    border-radius: 12px;
                    animation: glowing 12s linear infinite; /* più veloce */
                    opacity: 1;
                  }
                  ha-card::after {
                    content: "";
                    position: absolute;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: #111;
                    z-index: -1;
                    border-radius: 10px;
                  }
                  @keyframes glowing {
                    0% { background-position: 0 0; }
                    50% { background-position: 400% 0; }
                    100% { background-position: 0 0; }
                  }  

            ######### MANSARDA ##########
                  
            - type: custom:button-card
              name: Mansarda
              icon: mdi:home-roof
              tap_action:
                action: navigate
                navigation_path: /lovelace-mansarda/0?kiosk
              style:
                top: 40.00%
                left: 12.00%
                width: 240px
                height: 45px
              layout: name_icon
              styles:
                card:
                  - display: flex
                  - flex-direction: row
                  - justify-content: flex-start
                  - align-items: center
                  - background: rgba(255, 255, 255, 0.1)
                  - backdrop-filter: blur(10px)
                  - border: 1px solid rgba(255, 255, 255, 0.2) 
                  - border-radius: 10px
                  - padding: 0 24px
                  - height: 100%
                  - position: relative
                  - overflow: hidden
                name:
                  - color: white
                  - font-size: 18px
                  - font-weight: bold
                  - margin-right: 115px
                  - transform: translateY(-5px)
                icon:
                  - color: white
                  - width: 26px
                  - height: 26px
                  - margin-left: 160px
                  - transform: translateY(-5px)
              card_mod:
                style: |
                  ha-card {
                    position: relative;
                    z-index: 0;
                  }
                  ha-card::before {
                    content: "";
                    position: absolute;
                    top: -4px;
                    left: -4px;
                    width: calc(100% + 8px);
                    height: calc(100% + 8px);
                    background: linear-gradient(
                      45deg,
                      #ff0000,
                      #ff7300,
                      #fffb00,
                      #48ff00,
                      #00ffd5,
                      #002bff,
                      #7a00ff,
                      #ff00c8,
                      #ff0000
                    );
                    background-size: 400%;
                    z-index: -1;
                    filter: blur(6px);   /* meno sfocato → bordo più netto */
                    border-radius: 12px;
                    animation: glowing 12s linear infinite; /* più veloce */
                    opacity: 1;
                  }
                  ha-card::after {
                    content: "";
                    position: absolute;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: #111;
                    z-index: -1;
                    border-radius: 10px;
                  }
                  @keyframes glowing {
                    0% { background-position: 0 0; }
                    50% { background-position: 400% 0; }
                    100% { background-position: 0 0; }
                  }

              #################################################################
              #                                                               #
              #                           ANIMAZIONI                          #
              #                                                               #
              #################################################################

            ######### GOOGLE HOME ##########

            - action: none
              image: /local/floorplan/transparent.png
              entity: media_player.nesthube6f7
              state_image:
                "playing": /local/floorplan/musicnotes_animated.gif
              style:
                left: 53.00%
                mix-blend-mode: lighten
                # transform: rotate(160deg)
                top: 39%
                width: 13%
                # border: 1px solid red
              hold_action:
                action: fire-dom-event
                browser_mod:
                  service: browser_mod.popup
                  popup_anchor: true
                  data:
                    dismissable: true
                    size: normal
                    content:
                      type: custom:mushroom-media-player-card
                      entity: media_player.nesthube6f7
                      name: NEST Soggiorno
                      fill_container: true
                      volume_controls:
                        - volume_set
                        - volume_mute
                      media_controls:
                        - play_pause_stop
                      use_media_info: true
                      show_volume_level: true
                      icon: cil:google-home
                      collapsible_controls: true
                      layout: horizontal
              type: image                    

            ######### VENTILATORE SOGGIORNO ##########

            - type: image
              entity: fan.cucina_windcalm_fan
              tap_action:
                action: toggle
              hold_action:
                action: fire-dom-event
                browser_mod:
                  service: browser_mod.popup
                  popup_anchor: true
                  data:
                    dismissable: true
                    size: normal
                    content:
                      type: custom:mushroom-fan-card
                      entity: fan.cucina_windcalm_fan
                      show_percentage_control: true
                      show_oscillate_control: true
              style:
                top: 44.00%
                left: 65.50%
                width: 5%
                opacity: 0.3
                transform-origin: center
                transform-box: fill-box
                # teniamo il translate come base; i keyframes lo ripetono per non perderlo
                transform: translate(-50%, -50%)
                # animazione con sub-proprietà (più stabile):
                animation-name: rotation
                animation-duration: var(--fan-anim-duration, 1s)
                animation-timing-function: linear
                animation-iteration-count: infinite
                animation-play-state: var(--fan-anim-play, paused)
              state_image:
                "on": /local/floorplan/windcalm.png
                "off": /local/floorplan/windcalm.png
              card_mod:
                style: |
                  :host {
                    {% set speed = state_attr('fan.cucina_windcalm_fan', 'percentage') | default(0) %}
                    {% if is_state('fan.cucina_windcalm_fan','on') and speed > 0 %}
                      --fan-anim-duration: {{ ((100 - speed) / 40 + 0.5) | round(2) }}s;
                      --fan-anim-play: running;
                    {% else %}
                      /* Pausa l'animazione, niente salti/shift dell'immagine */
                      --fan-anim-duration: 1s;
                      --fan-anim-play: paused;
                    {% endif %}
                  }
            
                  @keyframes rotation {
                    0%   { transform: translate(-50%, -50%) rotate(0deg); }
                    100% { transform: translate(-50%, -50%) rotate(360deg); }
                  }